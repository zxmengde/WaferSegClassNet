# å­¦ä¹ æŒ‡å—ï¼šä»é›¶å¼€å§‹çš„æ·±åº¦å­¦ä¹ å®éªŒ

> é¢å‘æ·±åº¦å­¦ä¹ æ–°æ‰‹çš„å®Œæ•´æ•™ç¨‹ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ å®Œæˆæ™¶åœ†ç¼ºé™·è¯†åˆ«å®éªŒ

---

## ğŸ“š ç›®å½•

1. [ç¯å¢ƒé…ç½®](#1-ç¯å¢ƒé…ç½®)
2. [æ•°æ®å‡†å¤‡](#2-æ•°æ®å‡†å¤‡)
3. [æ¨¡å‹è®­ç»ƒ](#3-æ¨¡å‹è®­ç»ƒ)
4. [ç»“æœè¯„ä¼°](#4-ç»“æœè¯„ä¼°)
5. [å¸¸è§é—®é¢˜æ’æŸ¥](#5-å¸¸è§é—®é¢˜æ’æŸ¥)
6. [å…³é”®æ¦‚å¿µå°æŠ„](#6-å…³é”®æ¦‚å¿µå°æŠ„)
7. [å¦‚ä½•è¯»æ‡‚è®­ç»ƒæ—¥å¿—](#7-å¦‚ä½•è¯»æ‡‚è®­ç»ƒæ—¥å¿—)

---

## 1. ç¯å¢ƒé…ç½®

### 1.1 æ¿€æ´»condaç¯å¢ƒ

**å‘½ä»¤ï¼š**
```bash
conda activate wafer-seg-class
```

**é¢„æœŸè¾“å‡ºï¼š**
- å‘½ä»¤è¡Œå‰ç¼€å˜ä¸º `(wafer-seg-class)`

**éªŒè¯ç¯å¢ƒï¼š**
```bash
python -c "import torch; print(f'PyTorch: {torch.__version__}'); print(f'CUDA: {torch.cuda.is_available()}')"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
PyTorch: 2.5.1+cu121
CUDA: True
```

### 1.2 å¸¸è§ç¯å¢ƒé—®é¢˜

**é—®é¢˜1ï¼šæ‰¾ä¸åˆ°condaå‘½ä»¤**
- **åŸå› **ï¼šcondaæœªæ·»åŠ åˆ°PATH
- **è§£å†³**ï¼šä½¿ç”¨Anaconda Promptæˆ–é‡æ–°å®‰è£…Miniconda

**é—®é¢˜2ï¼šCUDAä¸å¯ç”¨**
- **åŸå› **ï¼šPyTorchç‰ˆæœ¬ä¸CUDAç‰ˆæœ¬ä¸åŒ¹é…
- **è§£å†³**ï¼šé‡æ–°å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„PyTorchï¼ˆè§ `docs/SETUP_WINDOWS.md`ï¼‰

---

## 2. æ•°æ®å‡†å¤‡

### 2.1 å‡†å¤‡æ•°æ®é›†

**æ­¥éª¤1ï¼šæ”¾ç½®åŸå§‹æ•°æ®**
```
data/raw/MixedWM38.npz  â† ä½ çš„æ•°æ®é›†æ–‡ä»¶
```

**æ­¥éª¤2ï¼šè¿è¡Œæ•°æ®å‡†å¤‡è„šæœ¬ï¼ˆdebugæ¨¡å¼ï¼‰**
```bash
conda run -n wafer-seg-class python scripts/prepare_mixedwm38.py --input data/raw/MixedWM38.npz --output data/processed --debug --max-per-class 5
```

**é¢„æœŸè¾“å‡ºï¼š**
```
[Info] Total samples: 38015
[Info] Debug mode: max 5 samples per class
[Info] Selected 190 samples for debug
[Info] Processed 190 samples
âœ“ Data preparation completed!
```

**æ­¥éª¤3ï¼šéªŒè¯æ•°æ®**
```bash
conda run -n wafer-seg-class python scripts/sanity_check_data.py --data_root data/processed
```

**é¢„æœŸè¾“å‡ºï¼š**
```
âœ“ Data sanity check PASSED
```

### 2.2 æ•°æ®å‡†å¤‡åšäº†ä»€ä¹ˆï¼Ÿ

1. **åŠ è½½åŸå§‹æ•°æ®**ï¼šä» `.npz` æ–‡ä»¶è¯»å–æ™¶åœ†å›¾è°±å’Œæ ‡ç­¾
2. **åƒç´ å€¼å¤„ç†**ï¼šå°†å¼‚å¸¸åƒç´ å€¼clipåˆ°0-2èŒƒå›´
3. **å›¾åƒç¼©æ”¾**ï¼šä»52Ã—52ç¼©æ”¾åˆ°224Ã—224ï¼ˆæ¨¡å‹è¾“å…¥å°ºå¯¸ï¼‰
4. **é¢œè‰²æ˜ å°„**ï¼š
   - 0ï¼ˆèƒŒæ™¯ï¼‰â†’ ç´«è‰² [255, 0, 255]
   - 1ï¼ˆæ­£å¸¸ï¼‰â†’ é’è‰² [0, 255, 255]
   - 2ï¼ˆç¼ºé™·ï¼‰â†’ é»„è‰² [255, 255, 0]
5. **ç”Ÿæˆmask**ï¼šç¼ºé™·åŒºåŸŸä¸ºç™½è‰²ï¼ˆ255ï¼‰ï¼Œå…¶ä»–ä¸ºé»‘è‰²ï¼ˆ0ï¼‰
6. **ä¿å­˜æ–‡ä»¶**ï¼š
   - `data/processed/Images/` - RGBå›¾åƒ
   - `data/processed/Labels/` - æ ‡ç­¾ï¼ˆ8ç»´å‘é‡ï¼‰
   - `data/processed/Masks/` - åˆ†å‰²æ©ç 

### 2.3 æ•°æ®æ ¼å¼è¯´æ˜

**æ ‡ç­¾æ ¼å¼ï¼ˆ8ç»´å‘é‡ï¼‰ï¼š**
```
[Center, Donut, Edge-Loc, Edge-Ring, Local, Near-full, Scratch, Random]
ä¾‹å¦‚ï¼š[1, 0, 1, 0, 0, 0, 0, 0] è¡¨ç¤º Center + Edge-Loc æ··åˆç¼ºé™·
```

**38ç±»æ˜ å°„ï¼š**
- ç±»0ï¼šNormalï¼ˆæ­£å¸¸ï¼‰
- ç±»1-8ï¼š8ç§å•ä¸€ç¼ºé™·
- ç±»9-37ï¼š29ç§æ··åˆç¼ºé™·

---

## 3. æ¨¡å‹è®­ç»ƒ

### 3.1 Debugæ¨¡å¼è®­ç»ƒï¼ˆå¿«é€ŸéªŒè¯ï¼‰

**å‘½ä»¤ï¼š**
```bash
conda run -n wafer-seg-class python train.py --config configs/e0_debug.yaml
```

**é¢„æœŸæ—¶é—´ï¼š** çº¦5ç§’

**é¢„æœŸè¾“å‡ºï¼š**
```
Experiment: e0_debug_debug
Device: cuda
GPU: NVIDIA GeForce RTX 4070 SUPER
Train samples: 152
Val samples: 19

Epoch 1/2
Training: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 19/19 [00:01<00:00]
Train - Loss: 4.15, Acc: 0.046, Dice: 0.629
Val - Loss: 4.29, Dice: 0.690

Epoch 2/2
Training: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 19/19 [00:00<00:00]
Train - Loss: 3.99, Acc: 0.086, Dice: 0.754
Val - Loss: 5.39, Dice: 0.834

Training completed!
```

### 3.2 å®Œæ•´è®­ç»ƒï¼ˆE0åŸºçº¿ï¼‰

**å‘½ä»¤ï¼š**
```bash
conda run -n wafer-seg-class python train.py --config configs/e0.yaml
```

**é¢„æœŸæ—¶é—´ï¼š** çº¦30-60åˆ†é’Ÿï¼ˆå–å†³äºæ•°æ®é‡å’ŒGPUï¼‰

**é…ç½®è¯´æ˜ï¼ˆ`configs/e0.yaml`ï¼‰ï¼š**
```yaml
experiment:
  name: "e0"           # å®éªŒåç§°
  seed: 42             # éšæœºç§å­ï¼ˆä¿è¯å¯å¤ç°ï¼‰
  debug: false         # å®Œæ•´è®­ç»ƒæ¨¡å¼

data:
  batch_size: 32       # æ‰¹æ¬¡å¤§å°ï¼ˆæ ¹æ®æ˜¾å­˜è°ƒæ•´ï¼‰
  num_workers: 4       # æ•°æ®åŠ è½½çº¿ç¨‹æ•°

training:
  epochs: 100          # è®­ç»ƒè½®æ•°
  learning_rate: 0.001 # å­¦ä¹ ç‡
  amp_enabled: true    # æ··åˆç²¾åº¦è®­ç»ƒï¼ˆèŠ‚çœæ˜¾å­˜ï¼‰
```

### 3.3 è®­ç»ƒè¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

**æ¯ä¸ªepochçš„æµç¨‹ï¼š**

1. **è®­ç»ƒé˜¶æ®µï¼ˆTrainingï¼‰**
   - æ¨¡å‹è¯»å–ä¸€æ‰¹å›¾åƒï¼ˆbatch_size=8æˆ–32ï¼‰
   - å‰å‘ä¼ æ’­ï¼šå›¾åƒ â†’ ç¼–ç å™¨ â†’ è§£ç å™¨ â†’ è¾“å‡ºï¼ˆåˆ†ç±»+åˆ†å‰²ï¼‰
   - è®¡ç®—æŸå¤±ï¼šåˆ†ç±»æŸå¤± + åˆ†å‰²æŸå¤±
   - åå‘ä¼ æ’­ï¼šè®¡ç®—æ¢¯åº¦
   - æ›´æ–°å‚æ•°ï¼šä¼˜åŒ–å™¨è°ƒæ•´æ¨¡å‹æƒé‡

2. **éªŒè¯é˜¶æ®µï¼ˆValidationï¼‰**
   - ä½¿ç”¨éªŒè¯é›†è¯„ä¼°æ¨¡å‹æ€§èƒ½
   - ä¸æ›´æ–°å‚æ•°ï¼Œåªè®¡ç®—æŒ‡æ ‡
   - æ ¹æ®macro-F1ä¿å­˜æœ€ä½³æ¨¡å‹

3. **ä¿å­˜checkpoint**
   - `last.pt`ï¼šæœ€åä¸€ä¸ªepochçš„æ¨¡å‹
   - `best.pt`ï¼šéªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½çš„æ¨¡å‹

---

## 4. ç»“æœè¯„ä¼°

### 4.1 è¯„ä¼°å‘½ä»¤

```bash
conda run -n wafer-seg-class python eval.py --config configs/e0.yaml --ckpt results/e0/checkpoints/best.pt
```

### 4.2 è¾“å‡ºæ–‡ä»¶

**ç›®å½•ç»“æ„ï¼š**
```
results/e0/
â”œâ”€â”€ checkpoints/
â”‚   â”œâ”€â”€ best.pt          # æœ€ä½³æ¨¡å‹
â”‚   â””â”€â”€ last.pt          # æœ€åæ¨¡å‹
â”œâ”€â”€ metrics.csv          # æŒ‡æ ‡æ±‡æ€»
â”œâ”€â”€ confusion_matrix.png # æ··æ·†çŸ©é˜µ
â”œâ”€â”€ seg_overlays/        # åˆ†å‰²å¯è§†åŒ–
â”œâ”€â”€ curves/              # è®­ç»ƒæ›²çº¿
â”‚   â”œâ”€â”€ loss.png
â”‚   â””â”€â”€ metrics.png
â”œâ”€â”€ train.log            # è®­ç»ƒæ—¥å¿—
â””â”€â”€ config_snapshot.yaml # é…ç½®å¿«ç…§
```

---

## 5. å¸¸è§é—®é¢˜æ’æŸ¥

### 5.1 CUDAç›¸å…³é—®é¢˜

**é—®é¢˜ï¼šRuntimeError: CUDA out of memory**

**åŸå› ï¼š** æ˜¾å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š**
1. å‡å°batch_sizeï¼ˆ32 â†’ 16 â†’ 8ï¼‰
2. å‡å°å›¾åƒå°ºå¯¸ï¼ˆ224 â†’ 128ï¼‰
3. ç¦ç”¨AMPï¼ˆ`amp_enabled: false`ï¼‰
4. å‡å°‘num_workersï¼ˆ4 â†’ 2 â†’ 0ï¼‰

**ä¿®æ”¹é…ç½®ï¼š**
```yaml
data:
  batch_size: 8  # ä»32æ”¹ä¸º8

training:
  amp_enabled: false  # ç¦ç”¨æ··åˆç²¾åº¦
```

---

### 5.2 æ•°æ®åŠ è½½é—®é¢˜

**é—®é¢˜ï¼šFileNotFoundError: data/processed/Images/...**

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥æ•°æ®æ˜¯å¦å‡†å¤‡å®Œæˆ
   ```bash
   dir data\processed\Images
   ```
2. é‡æ–°è¿è¡Œæ•°æ®å‡†å¤‡è„šæœ¬
3. æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼ˆWindowsç”¨åæ–œæ  `\`ï¼‰

---

### 5.3 è®­ç»ƒä¸æ”¶æ•›

**ç°è±¡ï¼š** Lossä¸ä¸‹é™ï¼ŒAccä¸€ç›´æ˜¯0

**å¯èƒ½åŸå› ï¼š**
1. **å­¦ä¹ ç‡è¿‡å¤§**ï¼šæ”¹ä¸º0.0001
2. **æ•°æ®é—®é¢˜**ï¼šæ£€æŸ¥æ ‡ç­¾æ˜¯å¦æ­£ç¡®
3. **æ¨¡å‹é—®é¢˜**ï¼šæ£€æŸ¥æ¨¡å‹è¾“å‡ºå½¢çŠ¶

**è°ƒè¯•æ–¹æ³•ï¼š**
```bash
# è¿è¡Œdebugæ¨¡å¼ï¼Œå¿«é€Ÿæ£€æŸ¥
python train.py --config configs/e0_debug.yaml
```

---

### 5.4 ä¾èµ–é—®é¢˜

**é—®é¢˜ï¼šModuleNotFoundError: No module named 'xxx'**

**è§£å†³ï¼š**
```bash
conda activate wafer-seg-class
pip install xxx
```

**å¸¸è§ç¼ºå¤±åŒ…ï¼š**
- `pip install opencv-python`
- `pip install pyyaml`
- `pip install tqdm`

---

## 6. å…³é”®æ¦‚å¿µå°æŠ„

### 6.1 è¯„ä¼°æŒ‡æ ‡

**Accuracyï¼ˆå‡†ç¡®ç‡ï¼‰**
- **å®šä¹‰**ï¼šé¢„æµ‹æ­£ç¡®çš„æ ·æœ¬æ•° / æ€»æ ·æœ¬æ•°
- **èŒƒå›´**ï¼š0-1ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰
- **é—®é¢˜**ï¼šç±»åˆ«ä¸å¹³è¡¡æ—¶ä¼šè¯¯å¯¼ï¼ˆå¦‚99%éƒ½æ˜¯æ­£å¸¸ï¼Œæ¨¡å‹å…¨é¢„æµ‹æ­£å¸¸ä¹Ÿæœ‰99%å‡†ç¡®ç‡ï¼‰

**Macro-F1ï¼ˆå®å¹³å‡F1ï¼‰**
- **å®šä¹‰**ï¼šæ¯ä¸ªç±»åˆ«F1åˆ†æ•°çš„å¹³å‡å€¼
- **ä¼˜ç‚¹**ï¼šå¯¹ç±»åˆ«ä¸å¹³è¡¡æ•æ„Ÿï¼Œæ˜¯æœ¬å®éªŒçš„ä¸»æŒ‡æ ‡
- **è®¡ç®—**ï¼š
  ```
  F1 = 2 Ã— (Precision Ã— Recall) / (Precision + Recall)
  Macro-F1 = (F1_class0 + F1_class1 + ... + F1_class37) / 38
  ```

**Diceç³»æ•°ï¼ˆåˆ†å‰²æŒ‡æ ‡ï¼‰**
- **å®šä¹‰**ï¼šé¢„æµ‹maskä¸çœŸå®maskçš„é‡å åº¦
- **èŒƒå›´**ï¼š0-1ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰
- **è®¡ç®—**ï¼š
  ```
  Dice = 2 Ã— |é¢„æµ‹ âˆ© çœŸå®| / (|é¢„æµ‹| + |çœŸå®|)
  ```

**IoUï¼ˆäº¤å¹¶æ¯”ï¼‰**
- **å®šä¹‰**ï¼šé¢„æµ‹maskä¸çœŸå®maskçš„äº¤é›†/å¹¶é›†
- **èŒƒå›´**ï¼š0-1ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰
- **å…³ç³»**ï¼šDice = 2Ã—IoU / (1+IoU)

---

### 6.2 æ·±åº¦å­¦ä¹ æœ¯è¯­

**Epochï¼ˆè½®æ¬¡ï¼‰**
- æ¨¡å‹çœ‹å®Œæ•´ä¸ªè®­ç»ƒé›†ä¸€é

**Batchï¼ˆæ‰¹æ¬¡ï¼‰**
- ä¸€æ¬¡å‰å‘ä¼ æ’­å¤„ç†çš„æ ·æœ¬æ•°
- batch_size=32ï¼šæ¯æ¬¡å¤„ç†32å¼ å›¾åƒ

**Learning Rateï¼ˆå­¦ä¹ ç‡ï¼‰**
- å‚æ•°æ›´æ–°çš„æ­¥é•¿
- å¤ªå¤§ï¼šä¸æ”¶æ•›ï¼Œéœ‡è¡
- å¤ªå°ï¼šæ”¶æ•›æ…¢

**Lossï¼ˆæŸå¤±ï¼‰**
- æ¨¡å‹é¢„æµ‹ä¸çœŸå®å€¼çš„å·®è·
- è®­ç»ƒç›®æ ‡ï¼šæœ€å°åŒ–loss

**Overfittingï¼ˆè¿‡æ‹Ÿåˆï¼‰**
- è®­ç»ƒé›†è¡¨ç°å¥½ï¼ŒéªŒè¯é›†è¡¨ç°å·®
- åŸå› ï¼šæ¨¡å‹è®°ä½äº†è®­ç»ƒæ•°æ®ï¼Œæ²¡æœ‰å­¦åˆ°é€šç”¨è§„å¾‹
- è§£å†³ï¼šæ•°æ®å¢å¼ºã€Dropoutã€Early Stopping

---

### 6.3 æœ¬å®éªŒç‰¹æœ‰æ¦‚å¿µ

**å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMulti-Task Learningï¼‰**
- åŒæ—¶è®­ç»ƒåˆ†ç±»å’Œåˆ†å‰²ä¸¤ä¸ªä»»åŠ¡
- å…±äº«ç¼–ç å™¨ï¼Œåˆ†åˆ«æœ‰åˆ†ç±»å¤´å’Œåˆ†å‰²å¤´
- ä¼˜ç‚¹ï¼šç‰¹å¾å…±äº«ï¼Œæå‡æ³›åŒ–èƒ½åŠ›

**æ··åˆç²¾åº¦è®­ç»ƒï¼ˆAMPï¼‰**
- éƒ¨åˆ†è®¡ç®—ç”¨fp16ï¼ˆåŠç²¾åº¦ï¼‰ï¼Œéƒ¨åˆ†ç”¨fp32ï¼ˆå•ç²¾åº¦ï¼‰
- ä¼˜ç‚¹ï¼šèŠ‚çœæ˜¾å­˜ï¼ŒåŠ é€Ÿè®­ç»ƒ
- æ³¨æ„ï¼šæŸäº›æ“ä½œï¼ˆå¦‚BCEï¼‰éœ€è¦ç‰¹æ®Šå¤„ç†

**é•¿å°¾åˆ†å¸ƒï¼ˆLong-Tailï¼‰**
- æ•°æ®é›†ä¸­æŸäº›ç±»åˆ«æ ·æœ¬å¾ˆå°‘ï¼ˆå¦‚NFç±»åªæœ‰149ä¸ªï¼‰
- é—®é¢˜ï¼šæ¨¡å‹åå‘å¤šæ•°ç±»
- è§£å†³ï¼šFocal Lossã€Class-Balanced Lossã€æ•°æ®å¢å¼º

**å¼±ç›‘ç£å­¦ä¹ ï¼ˆWeakly-Supervisedï¼‰**
- åªæœ‰å›¾åƒçº§æ ‡ç­¾ï¼ˆå¦‚"æœ‰Centerç¼ºé™·"ï¼‰ï¼Œæ²¡æœ‰åƒç´ çº§æ ‡ç­¾
- ä»»åŠ¡ï¼šé¢„æµ‹æ¯ä¸ªåƒç´ å±äºå“ªç§ç¼ºé™·
- æ–¹æ³•ï¼šCAMã€åŸå‹å­¦ä¹ ã€æ³¨æ„åŠ›æœºåˆ¶

---

## 7. å¦‚ä½•è¯»æ‡‚è®­ç»ƒæ—¥å¿—

### 7.1 è®­ç»ƒæ—¥å¿—ç¤ºä¾‹

```
Epoch 1/100
Training: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 152/152 [00:45<00:00, 3.37it/s, loss=4.15, acc=0.046, dice=0.629]
Validating: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 19/19 [00:02<00:00, 9.12it/s, loss=4.29, acc=0.000, dice=0.690]
Train - Loss: 4.1537, Acc: 0.0461, Dice: 0.6291
Val - Loss: 4.2863, Acc: 0.0000, Dice: 0.6902, Macro-F1: 0.0000
```

### 7.2 å…³é”®ä¿¡æ¯è§£è¯»

**è¿›åº¦æ¡ï¼š**
- `152/152`ï¼šå¤„ç†äº†152ä¸ªbatch
- `3.37it/s`ï¼šæ¯ç§’å¤„ç†3.37ä¸ªbatch
- `00:45`ï¼šæœ¬epochç”¨æ—¶45ç§’

**å®æ—¶æŒ‡æ ‡ï¼š**
- `loss=4.15`ï¼šå½“å‰batchçš„æŸå¤±
- `acc=0.046`ï¼šå½“å‰batchçš„åˆ†ç±»å‡†ç¡®ç‡ï¼ˆ4.6%ï¼‰
- `dice=0.629`ï¼šå½“å‰batchçš„åˆ†å‰²Diceç³»æ•°ï¼ˆ62.9%ï¼‰

**Epochæ€»ç»“ï¼š**
- `Train - Loss: 4.15`ï¼šè®­ç»ƒé›†å¹³å‡æŸå¤±
- `Val - Loss: 4.29`ï¼šéªŒè¯é›†å¹³å‡æŸå¤±
- `Macro-F1: 0.0000`ï¼šéªŒè¯é›†å®å¹³å‡F1ï¼ˆä¸»æŒ‡æ ‡ï¼‰

### 7.3 åˆ¤æ–­è®­ç»ƒæ˜¯å¦æ­£å¸¸

**âœ… æ­£å¸¸è®­ç»ƒçš„ç‰¹å¾ï¼š**
1. Lossé€æ¸ä¸‹é™
2. Acc/Diceé€æ¸ä¸Šå‡
3. Trainå’ŒValæŒ‡æ ‡å·®è·ä¸å¤§ï¼ˆ<10%ï¼‰

**âŒ å¼‚å¸¸æƒ…å†µï¼š**

**æƒ…å†µ1ï¼šLossä¸ä¸‹é™**
```
Epoch 1: Loss=4.15
Epoch 2: Loss=4.14
Epoch 3: Loss=4.16
...
```
- **åŸå› **ï¼šå­¦ä¹ ç‡è¿‡å¤§æˆ–è¿‡å°ã€æ•°æ®é—®é¢˜
- **è§£å†³**ï¼šè°ƒæ•´å­¦ä¹ ç‡ã€æ£€æŸ¥æ•°æ®

**æƒ…å†µ2ï¼šè¿‡æ‹Ÿåˆ**
```
Epoch 50: Train Loss=0.5, Val Loss=3.2
Epoch 51: Train Loss=0.4, Val Loss=3.5
```
- **ç‰¹å¾**ï¼šTrain Losså¾ˆä½ï¼ŒVal Losså¾ˆé«˜
- **è§£å†³**ï¼šEarly Stoppingã€æ•°æ®å¢å¼ºã€Dropout

**æƒ…å†µ3ï¼šæ¬ æ‹Ÿåˆ**
```
Epoch 100: Train Loss=3.8, Val Loss=3.9
```
- **ç‰¹å¾**ï¼šTrain Losså’ŒVal Losséƒ½å¾ˆé«˜
- **è§£å†³**ï¼šå¢åŠ æ¨¡å‹å®¹é‡ã€è®­ç»ƒæ›´å¤šepoch

---

## 8. å®éªŒæµç¨‹æ€»ç»“

### 8.1 å®Œæ•´æµç¨‹ï¼ˆ5æ­¥èµ°ï¼‰

```bash
# æ­¥éª¤1ï¼šæ¿€æ´»ç¯å¢ƒ
conda activate wafer-seg-class

# æ­¥éª¤2ï¼šå‡†å¤‡æ•°æ®ï¼ˆdebugæ¨¡å¼ï¼‰
python scripts/prepare_mixedwm38.py --input data/raw/MixedWM38.npz --output data/processed --debug

# æ­¥éª¤3ï¼šéªŒè¯æ•°æ®
python scripts/sanity_check_data.py --data_root data/processed

# æ­¥éª¤4ï¼šè®­ç»ƒæ¨¡å‹ï¼ˆdebugæ¨¡å¼ï¼‰
python train.py --config configs/e0_debug.yaml

# æ­¥éª¤5ï¼šè¯„ä¼°æ¨¡å‹
python eval.py --config configs/e0_debug.yaml --ckpt results/e0_debug_debug/checkpoints/last.pt
```

### 8.2 ä»Debugåˆ°å®Œæ•´è®­ç»ƒ

**Debugæ¨¡å¼ï¼ˆ5åˆ†é’Ÿï¼‰ï¼š**
- ç›®çš„ï¼šå¿«é€ŸéªŒè¯æµç¨‹
- æ•°æ®ï¼šæ¯ç±»5ä¸ªæ ·æœ¬
- Epochï¼š2
- è¾“å‡ºï¼š`results/e0_debug_debug/`

**å®Œæ•´è®­ç»ƒï¼ˆ30-60åˆ†é’Ÿï¼‰ï¼š**
- ç›®çš„ï¼šè·å¾—æœ€ä½³æ€§èƒ½
- æ•°æ®ï¼šå…¨éƒ¨38015ä¸ªæ ·æœ¬
- Epochï¼š100
- è¾“å‡ºï¼š`results/e0/`

**å‘½ä»¤å¯¹æ¯”ï¼š**
```bash
# Debug
python train.py --config configs/e0_debug.yaml

# å®Œæ•´
python train.py --config configs/e0.yaml
```

---

## 9. ä¸‹ä¸€æ­¥å­¦ä¹ 

### 9.1 å®éªŒè¿›åº¦

- âœ… Phase 0: ç¯å¢ƒé…ç½®
- âœ… Phase 1: æ•°æ®å‡†å¤‡ + Debugè®­ç»ƒ
- â³ Phase 2: E0å®Œæ•´è®­ç»ƒ
- â³ Phase 3: E1 SSLé¢„è®­ç»ƒ
- â³ Phase 4: E2 é•¿å°¾å¢å¼º
- â³ Phase 5: E3 æˆåˆ†åˆ†ç¦»
- â³ Phase 6: æŠ¥å‘Š + PPT

### 9.2 æ¨èé˜…è¯»

**æ·±åº¦å­¦ä¹ åŸºç¡€ï¼š**
- ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ï¼ˆææ²ï¼‰
- PyTorchå®˜æ–¹æ•™ç¨‹

**è®¡ç®—æœºè§†è§‰ï¼š**
- U-Netè®ºæ–‡ï¼ˆåˆ†å‰²ç»å…¸ï¼‰
- ResNetè®ºæ–‡ï¼ˆæ®‹å·®ç½‘ç»œï¼‰

**æœ¬å®éªŒç›¸å…³ï¼š**
- WaferMapè®ºæ–‡ï¼ˆæ™¶åœ†ç¼ºé™·æ£€æµ‹ï¼‰
- Multi-Task Learningç»¼è¿°

---

## 10. è·å–å¸®åŠ©

**é‡åˆ°é—®é¢˜æ—¶ï¼š**

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š`results/<exp_name>/train.log`
2. **æ£€æŸ¥é…ç½®**ï¼š`configs/<exp_name>.yaml`
3. **è¿è¡Œdebug**ï¼šå¿«é€Ÿå®šä½é—®é¢˜
4. **æŸ¥çœ‹æœ¬æŒ‡å—**ï¼šå¸¸è§é—®é¢˜ç« èŠ‚

**è®°ä½ï¼š**
- æ·±åº¦å­¦ä¹ æ˜¯å®éªŒç§‘å­¦ï¼Œå¤šè¯•å¤šè°ƒ
- æ¯æ¬¡åªæ”¹ä¸€ä¸ªå‚æ•°ï¼Œè§‚å¯Ÿæ•ˆæœ
- ä¿å­˜å¥½çš„checkpointï¼Œé¿å…é‡å¤è®­ç»ƒ

---

**ç¥ä½ å®éªŒé¡ºåˆ©ï¼ğŸ‰**
