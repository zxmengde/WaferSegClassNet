# E2 长尾增强实验配置
# E0 + 加权采样 + Focal Loss
# 用于处理类别不平衡问题，提升尾部类别识别性能

experiment:
  name: "e2"
  seed: 42
  debug: false

data:
  dataset: "MixedWM38"
  data_root: "data/processed"
  image_size: [224, 224]
  batch_size: 32
  num_workers: 4
  classification_mode: "single_label"
  # 加权采样器配置
  sampler: "inverse"  # uniform | inverse | sqrt_inverse | effective_num
  sampler_beta: 0.9999  # effective_num 模式的 beta 参数
  tail_class_threshold: 10  # 样本数少于此值的类为尾部类
  tail_augmentation_strength: 2.0  # 尾部类增强强度倍数
  augmentation:
    wafer_friendly: true
    rotation: [0, 90, 180, 270]
    flip: true
    morphological_noise: 0.15  # 略微增强形态学噪声

model:
  encoder: "custom"
  pretrained_weights: null
  classification_classes: 38
  segmentation_classes: 1
  separation_enabled: false
  separation_channels: 8

training:
  epochs: 100
  optimizer: "adamw"
  learning_rate: 0.001
  weight_decay: 0.01
  scheduler: "cosine"
  amp_enabled: true
  checkpoint_metric: "macro_f1"
  grad_accum_steps: 1
  debug_epochs: 2
  debug_batch_size: 8
  debug_max_per_class: 5

loss:
  # 使用 Focal Loss 处理类别不平衡
  classification: "focal"  # cross_entropy | focal | class_balanced
  segmentation: "bce_dice"
  separation: "kl_divergence"
  weights: [1.0, 1.0, 0.5]
  focal_gamma: 2.0  # Focal Loss gamma 参数
  focal_alpha: null  # null 表示自动计算
  class_balanced_beta: 0.9999  # Class-Balanced Loss beta 参数

output:
  results_dir: "results"
  save_every: 10
